<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐库接口</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1e1e1e;
            color: #ffffff;
        }
        .card-header {
            background-color: #282828;
            color: #ffffff;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center my-4">音乐库设置</h1>

        <!-- Scan Directory -->
        <div class="card mt-4">
            <div class="card-header">扫描目录</div>
            <div class="card-body">
                <input type="text" id="scanDirectory" class="form-control" placeholder="输入目录路径">
                <button id="scanButton" class="btn btn-primary mt-2">扫描</button>
            </div>
        </div>

        <!-- Add Artist -->
        <div class="card mt-4">
            <div class="card-header">添加艺术家</div>
            <div class="card-body">
                <input type="text" id="artistName" class="form-control" placeholder="输入艺术家名称">
                <button id="addArtistButton" class="btn btn-primary mt-2">添加艺术家</button>
            </div>
        </div>

        <!-- Merge Artists by UUID -->
        <div class="card mt-4">
            <div class="card-header">通过UUID合并艺术家</div>
            <div class="card-body">
                <input type="text" id="uuid1" class="form-control" placeholder="输入第一个艺术家UUID">
                <input type="text" id="uuid2" class="form-control mt-2" placeholder="输入第二个艺术家UUID">
                <button id="mergeArtistByUUIDButton" class="btn btn-primary mt-2">合并艺术家</button>
            </div>
        </div>

        <!-- Merge Artists by Name -->
        <div class="card mt-4">
            <div class="card-header">通过名称合并艺术家</div>
            <div class="card-body">
                <input type="text" id="name1" class="form-control" placeholder="输入第一个艺术家名称">
                <input type="text" id="name2" class="form-control mt-2" placeholder="输入第二个艺术家名称">
                <button id="mergeArtistByNameButton" class="btn btn-primary mt-2">合并艺术家</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const apibaseUrl = urlParams.get('apibaseUrl');

            if (!apibaseUrl) {
                alert('API 基础 URL 是必需的');
                return;
            }

            // Scan Directory
            document.getElementById('scanButton').addEventListener('click', function() {
                const directory = document.getElementById('scanDirectory').value;
                fetch(`${apibaseUrl}/scan?directory=${encodeURIComponent(directory)}`)
                    .then(response => response.json())
                    .then(data => alert('扫描完成: ' + JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            });

            // Add Artist
            document.getElementById('addArtistButton').addEventListener('click', function() {
                const name = document.getElementById('artistName').value;
                fetch(`${apibaseUrl}/add_artist?name=${encodeURIComponent(name)}`)
                    .then(response => response.json())
                    .then(data => alert('艺术家已添加: ' + JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            });

            // Merge Artists by UUID
            document.getElementById('mergeArtistByUUIDButton').addEventListener('click', function() {
                const uuid1 = document.getElementById('uuid1').value;
                const uuid2 = document.getElementById('uuid2').value;
                fetch(`${apibaseUrl}/merge_artist_by_uuid?uuid1=${encodeURIComponent(uuid1)}&uuid2=${encodeURIComponent(uuid2)}`)
                    .then(response => response.json())
                    .then(data => alert('艺术家已合并: ' + JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            });

            // Merge Artists by Name
            document.getElementById('mergeArtistByNameButton').addEventListener('click', function() {
                const name1 = document.getElementById('name1').value;
                const name2 = document.getElementById('name2').value;
                fetch(`${apibaseUrl}/merge_artist_by_name?name1=${encodeURIComponent(name1)}&name2=${encodeURIComponent(name2)}`)
                    .then(response => response.json())
                    .then(data => alert('艺术家已合并: ' + JSON.stringify(data)))
                    .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>